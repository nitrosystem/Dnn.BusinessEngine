<div ng-controller="createModuleModuleBuilderController as $" id="mobule-builder{{$.module.Id}}" class="module-builder">
    <!------------------------------------>
    <!--Sidebar-->
    <!------------------------------------>
    <section class="mb-sidebar" b-custom-sidebar="builder">
        <ul class="sidebar-tabs">
            <li class="tab-item" ng-class="{'active':$.currentSidebarTab=='toolbox'}" role="presentation"
                ng-click="$.onSidebarTabClick('toolbox')" b-custom-tooltip data-bs-placement="bottom"
                title="Components Toolbox">
                <a class="item-link" role="button">
                    <i class="codicon codicon-extensions"></i>
                </a>
            </li>
            <li class="tab-item" ng-class="{'active':$.currentSidebarTab=='field-settings'}" role="presentation"
                ng-click="$.onSidebarTabClick('field-settings')" b-custom-tooltip data-bs-placement="bottom"
                title="Current Field Settings">
                <a class="item-link" role="button">
                    <i class="codicon codicon-settings-gear"></i>
                </a>
            </li>
            <li class="tab-item" ng-class="{'active':$.currentSidebarTab=='filter-components'}" role="presentation"
                ng-click="$.onSidebarTabClick('filter-components')" b-custom-tooltip data-bs-placement="bottom"
                title="Filter Fields">
                <a class="item-link" role="button">
                    <i class="codicon codicon-filter"></i>
                </a>
            </li>
            <li class="tab-item" ng-class="{'active':$.currentSidebarTab=='actions'}" role="presentation"
                ng-click="$.onSidebarTabClick('actions')" b-custom-tooltip data-bs-placement="bottom"
                title="Current Field | Module Actions">
                <a class="item-link" role="button">
                    <i class="codicon codicon-github-action"></i>
                </a>
            </li>
        </ul>
        <div class="search-box">
            <input type="text" class="search-input" ng-model="$.searchComponent"
                placeholder="Search field type by title" ng-disabled="$.currentSidebarTab!=='toolbox'"
                ng-class="{'opacity-25':$.currentSidebarTab!=='toolbox'}" autocomplete="off" />
            <i class="codicon"
                ng-class="{'codicon-collapse-all':!$.collapsedComponentGroups,'codicon-expand-all':$.collapsedComponentGroups}"
                ng-click="$.collapsedComponentGroups=!$.collapsedComponentGroups"></i>
        </div>
        <div class="tab-contents b-scrollbar">
            <!------------------------------------>
            <!--Toolbox Tab-->
            <!------------------------------------>
            <div class="tab-content" ng-if="$.currentSidebarTab=='toolbox'">
                <div class=" field-types">
                    <div class="b-group group-sm mb-2"
                        ng-repeat="(key,value) in $.fieldTypes | orderBy:'GroupViewOrder' | fuzzyBy: 'Title': $.searchComponent |  groupBy:'GroupName'">
                        <div class="group-header" data-bs-toggle="collapse"
                            data-bs-target="#grpFieldType_{{$index}}_{{$.module.Id}}"
                            ng-class="{'collapsed':$.collapsedComponentGroups}">
                            <h3 class="group-label">
                                <span class="group-icon">
                                    <i class="codicon codicon-server-process"></i>
                                </span> {{key}}
                            </h3>
                            <span class="group-collapse">
                                <i class="codicon codicon-chevron-up"></i>
                            </span>
                        </div>
                        <div id="grpFieldType_{{$index}}_{{$.module.Id}}" class="group-content collapse"
                            ng-class="{'show':!$.collapsedComponentGroups}">
                            <div class="row">
                                <div class="col-6" ng-repeat="fieldType in value | toArray:false | orderBy:'ViewOrder'">
                                    <div class="field-type" title="{{fieldType.Title}}"
                                        jqyoui-draggable="{animate:true,onStop:'$.onStopDrag($index)'}"
                                        jqyoui-options="{appendTo: 'body',revert: 'invalid',helper: 'clone'}"
                                        data-drag="true" data-new-field="true"
                                        data-field-type="{{fieldType.FieldType}}">
                                        <img class="field-image" ng-src="{{fieldType.Icon}}" />
                                        <label class="title">{{fieldType.Title}}</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!------------------------------------>
            <!--Field Settings Tab-->
            <!------------------------------------>
            <div class="tab-content" ng-if="$.currentSidebarTab=='field-settings' && $.currentField">
                <div ng-include="$.fieldSettingsWidget"></div>
            </div>
            <div class="tab-content" ng-if="$.currentSidebarTab=='filter-components'">
            </div>
            <!------------------------------------>
            <!--Actions List-->
            <!------------------------------------>
            <div class="tab-content" ng-if="$.currentSidebarTab=='actions'">
                <div class="actions-header" ng-if="$.fieldActionsFilter">
                    <label class="field-title">{{$.currentField.FieldName}} Actions</label>
                    <span class="close-filter" ng-click="$.onRemoveActionsFilterClick()">
                        <i class="codicon codicon-close"></i>
                    </span>
                </div>
                <div ng-if="$.fieldActionsFilter && (!$.currentField.Actions ||!$.currentField.Actions.length)"
                    class="b-notify notify-info mb-4">
                    <i class="codicon codicon-info b-icon-2"></i>
                    <div class="text">
                        Current field has no any actions.
                    </div>
                </div>
                <ul class="action-list">
                    <li class="action-item"
                        ng-repeat="action in $.actions | fuzzyBy: 'FieldId': $.fieldActionsFilter | orderBy:['-FieldId','-ParentId','ViewOrder']">
                        <div class="action-type">
                            <i class="action-icon {{action.ActionTypeIcon}}"></i>
                            <span>{{action.ActionType}}</span>
                        </div>
                        <h5 class="action-title">
                            <span class="action-name">{{action.ActionName}}</span>
                            <span class="action-name">{{action.Event }}</span>
                            <span ng-if="!action.FieldId">Module Action</span>
                            <span ng-if="action.FieldId">{{action.FieldName}}</span>
                        </h5>
                        <div class="action-buttons">
                            <button type="button" class="b-btn btn-sm btn-action mb-2"
                                ng-click="$.onEditActionClick(action)">
                                <i class="codicon codicon-edit me-0"></i>
                            </button>
                            <button type="button" class="b-btn btn-sm btn-action mb-2"
                                ng-click="$.onDeleteActionClick(action.ActionId,$index)">
                                <i class="codicon codicon-trash me-0"></i>
                            </button>
                        </div>
                    </li>
                </ul>
                <div class="actions-footer">
                    <button type="button" class="b-btn btn-text-icon btn-action btn-sm me-2"
                        ng-click="$.onGotoActionsPageClick()">
                        <i class="codicon codicon-github-action"></i>
                        Actions Page
                    </button>
                    <button type="button" ng-if="!$.fieldActionsFilter" class="b-btn btn-text-icon btn-action btn-sm"
                        ng-click="$.onAddActionClick()">
                        <i class="codicon codicon-plus"></i>
                        New Action
                    </button>
                    <button type="button" ng-if="$.fieldActionsFilter" class="b-btn btn-text-icon btn-action btn-sm"
                        ng-click="$.onAddActionClick($.currentField.Id,$.currentField.FieldType)">
                        <i class="codicon codicon-plus"></i>
                        New Field Action
                    </button>
                </div>
            </div>
        </div>
    </section>
    <!------------------------------------>
    <!--Workspace Board-->
    <!------------------------------------>
    <b-content-widget data-title="{{$.module.ModuleTitle}} - {{$.module.ModuleType}} Module Builder"
        data-icon="notebook-template" data-module-type="module-builder" data-subtitle="{{$.module.ModuleName}}"
        data-await-action="$.awaitAction" class="mb-workspace" data-module="$" data-reload-method="onPageLoad"
        data-close-method="onCloseWindow" data-progress-id="progress{{$.currentTabKey}}">
        <div class="top-bar">
            <div class="workspace-actions">
                <button type="button" class="b-btn btn-action me-3" ng-click="$.onToggleSearchFieldsClick()"
                    data-bs-toggle="collapse" data-bs-target="#searchWrapper{{$.module.Id}}" aria-expanded="false"
                    aria-controls="searchWrapper{{$.module.Id}}">
                    <i class="codicon codicon-search me-0"></i>
                </button>
                <button type="button" class="b-btn btn-text-icon btn-action me-3"
                    ng-click="$.onAddActionClick()">
                    <i class="codicon codicon-git-pull-request-create"></i>
                    New Action
                </button>
                <button type="button" class="b-btn btn-text-icon btn-action me-3"
                    ng-click="$.onShowLayoutTemplateClick()">
                    <i class="codicon codicon-preview"></i>
                    Edit Layout Template
                </button>
                <!------------------------------------>
                <!-- Module Builder Action Items-->
                <!------------------------------------>
                <div id="buildWrapper{{$.module.Id}}" class="b-btn-group build-wrapper">
                    <span class="building progress-bar" ng-show="$.running=='building-module'"
                        ng-class="{'error':$.awaitAction.isError}">
                    </span>
                    <button type="button" class="b-btn btn-text-icon btn-text-icon btn-submit overflow-hidden"
                        ng-click="$.buildModule()" ng-disabled="$.running" title="Build & Render Module(F10)">
                        <i class="codicon" ng-class="{'spin':$.running!=='get-module-builder',
                        'codicon-terminal-debian': $.running!=='building-module',
                        'codicon-settings-gear': $.running==='building-module'}">
                        </i>
                        Build Module
                    </button>
                    <button type="button" class="b-btn btn-submit dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-expanded="false" ng-disabled="$.running">
                    </button>
                    <div class="dropdown-menu b-dropdown-menu">
                        <a class="dropdown-item" href="" ng-click="$.renderDesignForm()" b-custom-tooltip
                            data-bs-placement="top" title="Render design Form and display Fields in edit mode.">
                            <i class="codicon codicon-symbol-color"></i>Render Design Board(Reinit Panes & Fields)
                        </a>
                        <a class="dropdown-item" target="_blank" ng-href="{{$.moduleViewLinkUrl}}">
                            <i class="codicon codicon-output"></i> Show Module Output
                        </a>
                        <a class="dropdown-item" target="_blank" ng-click="$.onClearCache()" b-custom-tooltip
                            data-bs-placement="bottom" title="Clear dnn cache and add host crm version">
                            <i class="codicon codicon-issue-reopened"></i> Clear Cache & Add Version
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!------------------------------------>
        <!--Workspace Board-->
        <!------------------------------------>
        <div class="workspace-fields">
            <div class="collapse search-wrapper" id="searchWrapper{{$.module.Id}}">
                <input type="text" class="search-text" ng-if="$.module.Id" ng-model="$.searchText"
                    ng-change="$.onSearchTextChange()" b-custom-focus="onFocusSearchInput_{{$.module.Id}}"
                    placeholder="Search by field name, field text, field type and etc...">
                <i class="codicon codicon-search-fuzzy search-icon"></i>
            </div>
            <div id="board{{$.module.Id}}" class="panes"></div>
        </div>
    </b-content-widget>
    <!------------------------------------>
    <!--Build Widget-->
    <!------------------------------------>
    <div class="building-wrapper" ng-class="{'show':building}">
        <div class="drop"></div>
        <div class="content-wrapper">
            <div class="header-wrapper">
                <h5 class="header-title">Build Progress</h5>
                <div class="actions-bar" ng-if="building.isEnded">
                    <button type="button" class="b-btn btn-text-icon btn-submit btn-sm">
                        <i class="codicon codicon-preview"></i>
                        Preview
                    </button>
                    <button type="button" class="b-btn btn-text-icon btn-action btn-sm">
                        <i class="codicon codicon-open-preview"></i>
                        Show in Output
                    </button>
                    <button type="button" class="b-btn btn-text-icon btn-action btn-sm"
                        ng-click="$.onContinueEditFormClick()">
                        <i class="codicon codicon-debug-step-over"></i>
                        Conitinue
                    </button>
                </div>
            </div>
            <div class="body-wrapper">
                <div class="image-wrapper">
                    <img id="imgBuilding{{$.module.Id}}" />
                </div>
                <ul class="build-steps">
                    <li class="build-step module-template">
                        <div class="step-label">
                            1.Module Template
                            <span class="small">
                                (
                                Render
                                <span class="text-success" id="moduleTemplateFieldIndex{{$.module.Id}}">0</span>
                                Field(s)
                                From
                                <span class="text-primary" id="moduleTemplateFieldTotal{{$.module.Id}}"></span>
                                )
                            </span>
                        </div>
                        <div class="progress-wrapper">
                            <pre class="left-number">0</pre>
                            <div class="step-progress-bar">
                                <div class="progress-value" id="moduleTemplateProgress{{$.module.Id}}"></div>
                            </div>
                            <pre class="right-number">100</pre>
                        </div>
                    </li>
                    <li class="build-step field-scripts">
                        <label class="step-label">2.Field Scripts</label>
                        <div class="progress-wrapper">
                            <pre class="left-number">0</pre>
                            <div class="step-progress-bar">
                                <div class="progress-value" id="fieldsScriptsProgress{{$.module.Id}}"></div>
                            </div>
                            <pre class="right-number">100</pre>
                        </div>
                    </li>
                    <li class="build-step action-scripts">
                        <label class="step-label">3.Action Scripts</label>
                        <div class="progress-wrapper">
                            <pre class="left-number">0</pre>
                            <div class="step-progress-bar">
                                <div class="progress-value" id="actionsScriptsProgress{{$.module.Id}}"></div>
                            </div>
                            <pre class="right-number">100</pre>
                        </div>
                    </li>
                    <li class="build-step module-styles">
                        <label class="step-label">4.Css & Styles</label>
                        <div class="progress-wrapper">
                            <pre class="left-number">0</pre>
                            <div class="step-progress-bar">
                                <div class="progress-value" id="moduleStylesProgress{{$.module.Id}}"></div>
                            </div>
                            <pre class="right-number">100</pre>
                        </div>
                    </li>
                    <li class="build-step resources-libraries mb-0">
                        <label class="step-label">5.Resources & Libraries</label>
                        <div class="progress-wrapper">
                            <pre class="left-number">0</pre>
                            <div class="step-progress-bar">
                                <div class="progress-value" id="moduleLibrariesProgress{{$.module.Id}}"></div>
                            </div>
                            <pre class="right-number">100</pre>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="footer-wrapper">
                <ul class="logs" id="buildLogs{{$.module.Id}}"></ul>
            </div>
        </div>
    </div>

    <div ng-include="$.editLayoutTemplateWidget"></div>
    <div ng-include="$.moduleTemplateWidget"></div>
    <div ng-include="$.fieldTemplateWidget"></div>
    <div ng-include="$.fieldEditWidget"></div>
    <div ng-include="$.fieldShowConditionsWidget"></div>
    <div ng-include="$.fieldConditionalValuesWidget"></div>
    <div ng-include="$.fieldDataSourceWidget"></div>
</div>